package ExperimentalCalculations;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Random;

import HelperClasses.FileManipulation;



public class Poisson {
	public double[] arrivals; //= {0.0,0.045952868853468304,0.24218689861700166,0.27958818305113836,0.841692472509991,0.9130841241427848,1.0134539073374496,1.0184460094034933,1.066709340160446,1.146820300393971,1.2297714183189905,1.244755794039127,1.325040873575575,1.54366825473523,1.5758317276574836,1.786987280978019,1.8509509443141132,1.9300257026489747,2.0157866564442672,2.1527374883670682,2.426368530457811,2.455820358108758,2.6407356670705826,2.6630332881080943,2.6976200188183443,2.8710135125285445,2.896778478461039,3.35409301024984,3.3805100318719847,3.4395778133783326,3.4544050964406674,3.5414085342681605,3.589986939708699,3.6747270796102107,3.758092099585487,3.7909050991133824,4.035114262341599,4.100668916371505,4.148047007860542,4.338495260449777,4.344875179278772,4.4804702295215515,4.519837581425604,4.560032810092953,4.713944436467661,4.809797835882765,4.832375698357185,4.995954550400597,5.088859374538156,5.2082699127434156,5.261970310690305,5.376216282235444,5.559469904720066,5.710213059218694,5.735644890998948,5.807670851341974,5.898492190860096,6.1445354989234735,6.219384089063178,6.261484175434986,6.373320803291474,6.600321308729304,6.645876260412448,6.711645391533,6.902694455360048,6.90915023391448,6.9382182564721395,6.985833000186018,7.040642714918956,7.078148462167753,7.29042133226993,7.816868333953087,8.053208628891657,8.308338100855883,8.353405907364008,8.45858370520097,8.55327521172409,8.796406098917709,8.883278231227637,8.982055884051691,9.005726691997712,9.027296013148028,9.123346192528226,9.224442653634252,9.225334309067069,9.560400211724778,9.605669476845923,9.626577823140535,9.639339820583679,9.64875289452507,9.759362757558156,9.935869606351952,9.99828456201268,10.179435379020669,10.297442086342018,10.319233771698368,10.36597095242745,10.5447209313386,10.580811774470318,10.586880727808449,};
	public double[] departures;// = {1.5446274113141347,0.20529750196347613,2.3260963571811413,1.412486637742981,3.379491550839723,0.9372618166510585,1.0203295810592896,1.1764494455611965,1.4989033505545974,2.8879543775414165,1.9894398022093809,1.2640563651413572,3.4971911158152786,2.7316598557193554,2.133584699215328,1.871396283734086,2.6693761047565534,2.7152451029370406,2.418196007847868,4.759514948685796,4.030750229698748,4.005767312266554,2.946587341570646,2.7961461734137147,2.744937141273209,3.0819670996403663,3.6326457109148436,4.287384891371656,4.211162686510626,4.012572872793626,3.639381794916869,8.482052243492728,5.191806727561736,4.354419196894365,6.659221983404566,7.291590302456042,5.786613609042271,4.517260944363749,4.5696524644864756,5.013318770104958,4.5000683610518255,4.710030108511457,5.478606163854705,4.934342175949727,4.9215124249386495,6.853326262486194,5.231407316458932,6.491193604855981,5.70698251313147,5.794042396914096,5.431786557853687,7.797633093338369,5.955572530555292,5.792181464075699,7.9265146880088455,6.1854198550742225,6.2383131214990195,7.399974060247767,6.317184352475851,6.627119421114157,7.937935679965198,8.55468565403389,8.802100369470743,8.737175775354016,6.938723531826571,7.78964720331407,7.426313344764944,7.946824272011993,7.450994988499667,7.484064879261449,7.776537270494995,9.026740050629826,8.057072624242025,13.530179840664902,9.256056200825263,8.629572997318443,8.961246734137246,9.595448154442895,10.51866263282574,11.554866861853938,11.002421630083695,11.02583632203124,11.776671177930815,11.081791763859806,10.772911784621387,10.432555895105361,10.706146446123286,10.141443313969015,9.842782081722774,11.652220740984866,12.424978171608922,10.682578205274442,10.0614062914567,10.571294769024666,11.129943000788835,10.437412235684445,14.69906647071955,10.580075289107656,11.924457426130662,10.889194982345808,};
	
	//arrival rate
	public double lambda;
	
	//departure rate
	public double mu;
	
	/**
	 * 
	 * @param lambda arrival rate
	 * @param mu departure rate
	 * @param nbRequests number of requests
	 * @param fileName where to print the poisson information
	 * @throws IOException 
	 */
	public Poisson(double lambda,double mu, int nbRequests) throws IOException
	{
		this.lambda = lambda;
		this.mu = mu;
		this.arrivals = generatePoissonArrival(nbRequests);
		this.departures = generatePoissonDeparture( nbRequests, arrivals);
			
	}

	public double[] generatePoissonArrival(int nbRequests){

		double [] arrival = new double[nbRequests];
		Random generator = new Random();
		//set the first arrival time to 0
		arrival[0] = 0.0;
		for(int i=1;i<nbRequests;i++){
			double t0 = arrival[i-1];
			double u = generator.nextFloat();
			if(u > 0){				
				double t = t0 - ((1/this.lambda)*Math.log(u));
				arrival[i] = t;
			}
		}
		return arrival;
	}

	public double[] generatePoissonDeparture( int nbRequests,double[] arrival){
		
		Random generator = new Random();
		double[] departure = new double[nbRequests];

		for(int i=0;i<arrival.length;i++){
			double u = generator.nextFloat();
			if(u > 0){
				double d = arrival[i] - ((1/this.mu)*Math.log(u));
				departure[i] = d;
			}
		}
		return departure;
	}
	
	
	/**
	 * This function returns a string of poisson distribution load 
	 * Arrivals and departures
	 * 
	 * @return String
	 */
	public String toString ()
	{
		String poissonInfo= " ";

		poissonInfo +="\n------------------------------------------------------------ Poisson distribution with | load :"+ this.lambda/this.mu+" | Arrival Rate = "+this.lambda+" | Departure Rate = "+this.mu+"----------------------------------------------------------------------\n";
		
		poissonInfo +="public double[] arrivals = {";
		for(int i=0;i<arrivals.length;i++){
			poissonInfo +=arrivals[i]+",";
		}
		poissonInfo+=" }; \n";		
		
		poissonInfo+="public double[] departures = {";
		for(int i=0;i<departures.length;i++){
			poissonInfo+= departures[i]+",";
		}
		poissonInfo+= "};\n";
		poissonInfo +=" -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------\n\n";
		return poissonInfo;
	}

}